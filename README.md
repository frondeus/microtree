# microtree

`microtree` is an experimental lossless tree for storing and building code.

```rust
use microtree::{Ast, AstBuilder, GreenBuilder, IntoBuilder};

mod generated; // Generated by `cargo xtask codegen`
use generated::*;

fn main() {
    let mut builder = GreenBuilder::default(); // Acts like cache

    let sexp: Value = List::build()
        .fill(
            LParen::build(),
            vec![
                Atom::build("bar").into_dyn(),
                Atom::build("foo").with_pre("\n  ").into_dyn(),
                Cons::build()
                    .fill(
                        LParen::build().with_pre(" "),
                        Atom::build("car").into_builder(),
                        Dot::build().with_pre(" "),
                        Atom::build("cdr").with_pre(" ").into_builder(),
                        RParen::build(),
                    )
                    .into_dyn(),
                Nil::build()
                    .fill(LParen::build().with_pre(" "), RParen::build())
                    .into_dyn(),
            ],
            RParen::build(),
        )
        .into_builder()
        .build(&mut builder);

    println!("DEBUG: {:?}\n", sexp);

    println!("ESCAPED:");
    print(&sexp);

    println!("\nPLAIN:");
    println!("`{}`", sexp.red().green());
}
```

Output:
```
DEBUG: List(List(Red(RedData { kind: Root, green: 
--- GREEN TREE ---
Value, List @ 0..28
    token @ 0..1 `(`
    Value, atom @ 1..5 `bar`
    Value, atom @ 5..12 `foo` ; pre: `\n  `
    Value, Cons @ 12..24
        token @ 12..14 `(` ; pre: ` `
        Value, atom @ 14..17 `car`
        token @ 17..19 `.` ; pre: ` `
        Value, atom @ 19..23 `cdr` ; pre: ` `
        token @ 23..24 `)`
    Value, Nil @ 24..27
        token @ 24..26 `(` ; pre: ` `
        token @ 26..27 `)`
    token @ 27..28 `)`
--- END ---
 })))

ESCAPED:
`(bar\n  foo (car . cdr) ())`

PLAIN:
`(bar
  foo (car . cdr) ())`
```

It shouldn't be used on production. Instead you may want to consider [`rowan`](https://github.com/rust-analyzer/rowan).

# implementation

It uses Red-Green tree data structure used in Swift, Roslyn and Rust-Analyzer.
It also focuses on structural editing just like `libSyntax` in Swift.

This repository also contains `xtask` library which generates AST from [`Ungrammar`](https://github.com/rust-analyzer/ungrammar) syntax.

# examples

All examples are in `crates/lib/examples`.

